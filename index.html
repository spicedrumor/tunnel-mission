<HTML>
<HEAD>
<TITLE> Tunnel Mission </TITLE>
</HEAD>
<BODY>

<script language="Javascript">
  var KEY_CODE_W = 87;
  var KEY_CODE_A = 65;
  var KEY_CODE_S = 83;
  var KEY_CODE_D = 68;
  var MAP_VAL_PLAYER = 1;
  var map;
  var mapString;
  var xPos;
  var yPos;

  xPos = 0;
  yPos = 0;

  map = [
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  ];

  function validMove(newX, newY)
  {
    var result;
    var mapWidth;
	var mapHeight;
	var notTooSmall;
	var notTooBig;

    result = false;
	mapWidth = map[0].length;
	mapHeight = map.length;

	if (newX >= 0 && newY >= 0)
	{
      notTooSmall = true;
	}
	if (newX < mapWidth && newY < mapHeight)
	{
	  notTooBig = true;
	}

	if (notTooSmall && notTooBig)
	{
	  if (map[newY][newX] == 0)
	  {
        result = true;
	  }
	}

	return result;
  }

  function move(direction, originX, originY, value)
  {
    var result;
    var offsetX;
	var offsetY;
	var newX;
	var newY;
    
    result = [];
	result[0] = originX;
	result[1] = originY;

	offsetX = 0;
	offsetY = 0;

	if (direction === "n")
	{
	  offsetY = -1;
	}
	else if (direction === "e")
	{
	  offsetX = 1;
	}
	else if (direction === "s")
	{
	  offsetY = 1;
	}
	else if (direction === "w")
	{
	  offsetX = -1;
	}

	newX = originX + offsetX;
	newY = originY + offsetY;

	if (validMove(newX, newY))
	{
	  map[originY][originX] = 0;
	  map[newY][newX] = value;
	  result[0] = newX;
	  result[1] = newY;
	}
	else
	{
	}

	return result;
  }

  window.onkeyup = function(e)
  {
    var direction;
	var newCoords;
    var key = e.keyCode ? e.keyCode : e.which;
          
    direction = "";
    if (key == KEY_CODE_W)
    {
      direction = "n";
    }
    else if (key == KEY_CODE_D)
    {
      direction = "e";
    }
    else if (key == KEY_CODE_S)
    {
      direction = "s";
    }
    else if (key == KEY_CODE_A)
    {
      direction = "w";
    }

	if (direction === "")
	{
	}
	else
	{
      newCoords = move(direction, xPos, yPos, MAP_VAL_PLAYER);
	  xPos = newCoords[0];
	  yPos = newCoords[1];
	}

    mapString = mapToString(map);
    document.body.innerHTML = mapString;
  }

  function mapToString(map)
  {
    var i;
	var j;
	var result;

    result = "<h2><code>";
	for (i = 0; i < map.length; i++)
	{
      for (j = 0; j < map[0].length; j++)
	  {
        if (map[i][j] == 1)
		{
		  result += "@";
		}
		else if (map[i][j] == 0)
		{
		  result += ".";
		}
		else
		{
		  result += map[i][j];
		}
	  }
      result += "<br>";
	}

	result += "</code></h2><br>";
    return result;
  }

  mapString = mapToString(map);
  document.body.innerHTML += mapString;
</script>

</BODY>
</HTML>
